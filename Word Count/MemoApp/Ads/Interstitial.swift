//
//  Interstitial.swift
//  Word Count
//


//import SwiftUI

import GoogleMobileAds

class Interstitial: NSObject, GADFullScreenContentDelegate, ObservableObject {
    @Published var interstitialAdLoaded: Bool = false
    var InterstitialAd: GADInterstitialAd?

    override init() {
        super.init()
    }

    //ã‚¤ãƒ³ã‚¿ãƒ¼ã‚¹ãƒ†ã‚£ã‚·ãƒ£ãƒ«åºƒå‘Šå°‚ç”¨ID
    //ãƒ†ã‚¹ãƒˆç”¨ï¼šca-app-pub-3940256099942544/4411468910
    //æœ¬ç•ªç”¨ï¼šca-app-pub-1474069724283041/1992433431
    let adUnitID = "ca-app-pub-1474069724283041/1992433431"
    
    func LoadInterstitial() {
        GADInterstitialAd.load( withAdUnitID: adUnitID, request: GADRequest()) {(ad, error) in
            if let _ = error {
                print("ğŸ˜­: èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ")
                self.interstitialAdLoaded = false
                return
            }
            print("ğŸ˜: èª­ã¿è¾¼ã¿ã«æˆåŠŸã—ã¾ã—ãŸ")
            self.interstitialAdLoaded = true
            self.InterstitialAd = ad
            self.InterstitialAd?.fullScreenContentDelegate = self
        }
    }

    // ã‚¤ãƒ³ã‚¿ãƒ¼ã‚¹ãƒ†ã‚£ã‚·ãƒ£ãƒ«åºƒå‘Šã®è¡¨ç¤º
    func ShowInterstitial() {
        let scenes = UIApplication.shared.connectedScenes
        let windowScenes = scenes.first as? UIWindowScene
        let root = windowScenes?.keyWindow?.rootViewController
        
        if let ad = InterstitialAd {
            ad.present(fromRootViewController: root!)
            self.interstitialAdLoaded = false
        } else {
            print("ğŸ˜­: åºƒå‘Šã®æº–å‚™ãŒã§ãã¦ã„ã¾ã›ã‚“ã§ã—ãŸ")
            self.interstitialAdLoaded = false
            self.LoadInterstitial()
        }
    }
    // å¤±æ•—é€šçŸ¥
    func ad(_ ad: GADFullScreenPresentingAd, didFailToPresentFullScreenContentWithError error: Error) {
        print("ã‚¤ãƒ³ã‚¿ãƒ¼ã‚¹ãƒ†ã‚£ã‚·ãƒ£ãƒ«åºƒå‘Šã®è¡¨ç¤ºã«å¤±æ•—ã—ã¾ã—ãŸ")
        self.interstitialAdLoaded = false
        self.LoadInterstitial()
    }

    // è¡¨ç¤ºé€šçŸ¥
    func adWillPresentFullScreenContent(_ ad: GADFullScreenPresentingAd) {
        print("ã‚¤ãƒ³ã‚¿ãƒ¼ã‚¹ãƒ†ã‚£ã‚·ãƒ£ãƒ«åºƒå‘Šã‚’è¡¨ç¤ºã—ã¾ã—ãŸ")
        self.interstitialAdLoaded = false
    }

    // ã‚¯ãƒ­ãƒ¼ã‚ºé€šçŸ¥
    func adDidDismissFullScreenContent(_ ad: GADFullScreenPresentingAd) {
        print("ã‚¤ãƒ³ã‚¿ãƒ¼ã‚¹ãƒ†ã‚£ã‚·ãƒ£ãƒ«åºƒå‘Šã‚’é–‰ã˜ã¾ã—ãŸ")
        self.interstitialAdLoaded = false
    }
}
